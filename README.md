## Rusty Arch
Virtual development environment for the [Rust Programming Language](https://www.rust-lang.org/), based on [Arch Linux](https://archlinux.org/).

### Dependencies
- VirtualBox 6.1
- Vagrant

### Features
- Tested on MacOS Catalina, no need for Homebrew or Xcode.
- Intended for offline use on inexpensive hardware (x86-64).

### Why Arch Linux?
The [philosophy behind Arch](https://en.wikipedia.org/wiki/Arch_Linux#Design_and_principles) and the community that has grown around it makes it delightful to work with.

### Why Rust?
For many of the same reasons as Arch. An inclusive community which appreciates the human time that is devoted to computing. Programs written in Rust tend to be very enjoyable to use.

### Why [SSHFS](https://github.com/libfuse/sshfs#about)?
Using SSH as the only communication channel is simple. NFS and SMB are very difficult to configure.

Benefits

- Does not require the host and guest to have the same file system case-sensitivity.
- The *vagrant-sshfs* plugin supports reverse mounts.

Drawbacks

- Prevents the use of an IDE in the host OS.
- Code stored in the shared directory won't necessarily compile successfully with [cargo](https://doc.rust-lang.org/cargo/). File access errors tend to occur.

    `note: failed to open file '/vagrant/projects/mdblog.rs/target/debug/deps/libtypenum-e60ae6a059d8af69.rlib': Operation not permitted (os error 1)`

    I haven't reached the root cause of this, as the failures are inconsistent.
    Instead of compiling in the shared directory I use /home/vagrant as my workspace and back up anything that isn't in git. An alternative is to share files with *vboxfs* instead of SSHFS,
    which presents a different [issue](https://www.reddit.com/r/rust/comments/7yy9a6/is_rustc_complaining_about_the_filesystem_for).

- No longer maintained.
- Not as performant as NFS or SMB. Running `head -c 500M /dev/urandom > sample.txt` in the shared directory takes 18s on my machine.

## Base System

- [archlinux/archlinux](https://app.vagrantup.com/archlinux/boxes/archlinux) Vagrant box
- [LTS kernel](https://archlinux.org/packages/core/x86_64/linux-lts/)
- [git](https://en.wikipedia.org/wiki/Git)
- [zsh](https://en.wikipedia.org/wiki/Z_shell)
- [ohmyzsh](https://ohmyz.sh/)
- [starship](https://starship.rs/)
- [lsd](https://crates.io/crates/lsd)
- [helix](https://helix-editor.com/)
- [zellij](https://zellij.dev/)
- [rustup](https://rust-lang.github.io/rustup/) (stable and nightly channels)
- [rust-analyzer](https://blog.rust-lang.org/2022/02/21/rust-analyzer-joins-rust-org.html)
- [gcc](https://en.wikipedia.org/wiki/GNU_Compiler_Collection)

## Usage
1. Install dependencies

    [VirtualBox 6.1](https://www.virtualbox.org/wiki/Download_Old_Builds_6_1)
    It's important to use this version to avoid errors related to package signatures (ex. `signature from "David Runge <dvzrv@archlinux.org>" is invalid`).
    
    [Vagrant](https://developer.hashicorp.com/vagrant/downloads)
    
    [vagrant-sshfs](https://github.com/dustymabe/vagrant-sshfs) plugin

2. Prepare environment

    Export environment variables so that vagrant can pass them to the provisioner.

    ```
    # needed by pacman for processing package signatures
    export TZ='your/timezone/here'
    # needed by sshfs to map file permissions
    export UID GID
    ```

    If you need offline access to the books and documentation generated by [rustup](https://rustup.rs/), create a `../rusty_docs` directory and [install SSHFS](https://ports.macports.org/port/sshfs/). Then you'll be able to point your browser at file:///path/to/your/rusty_docs/html/std/index.html

3. Build

    ```
    # creates the VM, but fails because vagrant-sshfs plugin can't
    # install sshfs in the guest yet (provisioner hasn't run yet)
    vagrant up
    
    # provision the VM
    vagrant up
    
    # install sshfs in the guest and mount shared directories
    vagrant sshfs --mount
    ```

4. Verify

    ```
    vagrant ssh 
    ```

    or alternatively, use the helper script (manages a tunnel on port 5000)

    ```
    ./session.sh
    ```

5. Enjoy Rust! Programming is supposed to be fun.
6. Read SECRETS.md

## Intended Improvements
- automated local snapshots
- generic cloud hosting
- AArch64 on QEMU

## Related Work
- [rust-sandbox](https://github.com/jameslmartin/rust-sandbox) is similar in intent but more opinionated
